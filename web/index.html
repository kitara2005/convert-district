<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chuyển đổi ĐVHC sau sáp nhập</title>
    <meta name="description" content="Công cụ chuyển đổi đơn vị hành chính Việt Nam trước/sau sáp nhập: tìm nhanh tỉnh, huyện, phường/xã mới và cũ." />
    <meta name="robots" content="index, follow" />
    <meta property="og:title" content="Chuyển đổi ĐVHC sau sáp nhập" />
    <meta property="og:description" content="Tìm nhanh tỉnh, huyện, phường/xã trước và sau sáp nhập." />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="vi_VN" />
    <meta name="twitter:card" content="summary" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-white border-bottom shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand fw-semibold" href="#">ĐVHC Việt Nam</a>
      </div>
    </nav>
    <header class="hero">
      <div class="container hero__inner text-center">
        <h1 class="display-6 mb-1">Chuyển đổi đơn vị hành chính sau sáp nhập</h1>
        <p class="lead text-muted mb-0">Tra cứu nhanh giữa dữ liệu cũ và mới, hỗ trợ tìm kiếm không dấu</p>
      </div>
    </header>
    <main class="container">
      <ul class="nav nav-pills justify-content-center mb-3" id="tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="tab-before-btn" data-bs-toggle="pill" data-bs-target="#tab-before" type="button" role="tab">Chuyển đổi trước sáp nhập</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-after-btn" data-bs-toggle="pill" data-bs-target="#tab-after" type="button" role="tab">Chuyển đổi sau sáp nhập</button>
        </li>
      </ul>
      <div class="tab-content" id="app"></div>

      <section class="card mt-4" aria-labelledby="map-title">
        <h2 id="map-title" class="h5 mb-3">Bản đồ Việt Nam sau sáp nhập</h2>
        <figure class="vn-map">
          <img id="vn-map-img"
            src="assets/vietnam-map.jpg"
            alt="Bản đồ Việt Nam sau sáp nhập"
            loading="lazy"
            style="cursor: zoom-in;"
          />
          <figcaption class="muted small mt-2">Nguồn: Cổng Thông tin điện tử Chính phủ — Bản đồ Việt Nam sau sáp nhập. [Xem ảnh gốc](https://bcp.cdnchinhphu.vn/334894974524682240/2025/7/8/bando1-1751971593268258350991.jpg)</figcaption>
        </figure>
      </section>
    </main>
    <script>
      (function(){
        const img = document.getElementById('vn-map-img');
        if (!img) return;
        const fallback = "data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='1024' height='512'>\
  <defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'>\
    <stop offset='0%' stop-color='%23eef3ff'/><stop offset='100%' stop-color='%23ffffff'/>\
  </linearGradient></defs>\
  <rect fill='url(%23g)' width='100%' height='100%'/>\
  <text x='50%' y='50%' text-anchor='middle' dominant-baseline='middle' fill='%237a88aa' font-size='24' font-family='Arial, sans-serif'>Bản đồ đang cập nhật</text>\
</svg>";
        img.addEventListener('error', ()=>{ img.src=fallback; });

        // Click to open zoom modal
        img.addEventListener('click', ()=>{
          // Use the resolved image URL to avoid broken links on subpath (GitHub Pages)
          openZoom(img.currentSrc || img.src);
        });

        function openZoom(src){
          const modal = document.createElement('div');
          modal.className = 'modal fade';
          modal.tabIndex = -1;
          modal.innerHTML = `
            <div class="modal-dialog modal-fullscreen">
              <div class="modal-content">
                <div class="modal-body p-0">
                  <div class="zoom-wrap" id="zoomWrap">
                    <img id="zoomImg" src="${src}" alt="Bản đồ Việt Nam sau sáp nhập" />
                    <div class="zoom-tools">
                      <button type="button" class="btn btn-light border" id="zoomIn">+</button>
                      <button type="button" class="btn btn-light border" id="zoomOut">−</button>
                      <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Đóng</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>`;
          document.body.appendChild(modal);
          const bsModal = new bootstrap.Modal(modal);
          bsModal.show();
          let scale = 1, originX = 0, originY = 0, dragging = false, startX=0, startY=0;
          const zImg = modal.querySelector('#zoomImg');
          const wrap = modal.querySelector('#zoomWrap');
          function apply(){ zImg.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`; }
          modal.querySelector('#zoomIn').onclick = ()=>{ scale = Math.min(5, scale*1.2); apply(); };
          modal.querySelector('#zoomOut').onclick = ()=>{ scale = Math.max(1, scale/1.2); if (scale===1){ originX=0; originY=0; } apply(); };
          zImg.addEventListener('mousedown', (e)=>{ if (scale<=1) return; dragging=true; zImg.classList.add('dragging'); startX=e.clientX-originX; startY=e.clientY-originY; });
          window.addEventListener('mousemove', (e)=>{ if(!dragging) return; originX=e.clientX-startX; originY=e.clientY-startY; apply(); });
          window.addEventListener('mouseup', ()=>{ dragging=false; zImg.classList.remove('dragging'); });
          // Wheel/trackpad zoom (pinch on macOS sends wheel with ctrlKey)
          function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
          wrap.addEventListener('wheel', (e)=>{
            // Only zoom on pinch-gesture (ctrlKey on macOS) to avoid accidental image move while scrolling
            if (!(e.ctrlKey)) return;
            e.preventDefault();
            const rect = wrap.getBoundingClientRect();
            const cx = e.clientX - rect.left;
            const cy = e.clientY - rect.top;
            // Image-space coords before scaling
            const ix = (cx - originX) / scale;
            const iy = (cy - originY) / scale;
            const factor = Math.exp((-e.deltaY) * 0.0015);
            const newScale = clamp(scale * factor, 1, 5);
            // Keep cursor point stable
            originX = cx - ix * newScale;
            originY = cy - iy * newScale;
            scale = newScale;
            apply();
          }, { passive: false });

          // Touch support (one-finger pan, two-finger pinch zoom)
          zImg.addEventListener('touchstart', (e)=>{ if(e.touches.length===1 && scale>1){ dragging=true; const t=e.touches[0]; startX=t.clientX-originX; startY=t.clientY-originY; } }, {passive:true});
          zImg.addEventListener('touchmove', (e)=>{ if(!dragging||e.touches.length!==1) return; const t=e.touches[0]; originX=t.clientX-startX; originY=t.clientY-startY; apply(); }, {passive:true});
          zImg.addEventListener('touchend', ()=>{ dragging=false; });
          let pinch = { active:false, startDist:0, startScale:1, cx:0, cy:0 };
          wrap.addEventListener('touchstart', (e)=>{
            if (e.touches.length===2){
              e.preventDefault();
              pinch.active = true;
              const [a,b] = e.touches;
              const rect = wrap.getBoundingClientRect();
              pinch.cx = ((a.clientX + b.clientX)/2) - rect.left;
              pinch.cy = ((a.clientY + b.clientY)/2) - rect.top;
              const dx = a.clientX - b.clientX; const dy = a.clientY - b.clientY;
              pinch.startDist = Math.hypot(dx, dy);
              pinch.startScale = scale;
            }
          }, { passive:false });
          wrap.addEventListener('touchmove', (e)=>{
            if (pinch.active && e.touches.length===2){
              e.preventDefault();
              const [a,b] = e.touches;
              const dx = a.clientX - b.clientX; const dy = a.clientY - b.clientY;
              const dist = Math.hypot(dx, dy);
              const rect = wrap.getBoundingClientRect();
              const cx = ((a.clientX + b.clientX)/2) - rect.left;
              const cy = ((a.clientY + b.clientY)/2) - rect.top;
              // Image coords at pinch center
              const ix = (cx - originX) / scale;
              const iy = (cy - originY) / scale;
              const newScale = clamp(pinch.startScale * (dist / pinch.startDist), 1, 5);
              originX = cx - ix * newScale;
              originY = cy - iy * newScale;
              scale = newScale;
              apply();
            }
          }, { passive:false });
          wrap.addEventListener('touchend', ()=>{ pinch.active=false; }, { passive:true });
          modal.addEventListener('hidden.bs.modal', ()=>{ bsModal.dispose(); modal.remove(); });
        }
      })();
    </script>
    <footer class="footer">
      <div class="container">
        <span class="text-muted small">© 2025 Chuyển đổi ĐVHC</span>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script type="module" src="main.js"></script>
  </body>
  </html>


